# 20241107 基于情绪感知的智能家具系统

# 项目灵感

本项目的灵感来源于现代生活中人们日益增长的情绪管理需求。随着生活节奏加快，压力和情绪问题变得越来越普遍。传统的家具只能提供基本的功能，而无法对使用者的情绪状态做出响应。通过将情绪感知技术与智能家具相结合，我们希望创造出一个能够主动关心和照顾用户情绪健康的生活环境。

# 创新点

家具如沙发、床等智能家具可以根据用户的情绪状态做出反馈，调整舒适度、亮度、温度等。例如，当用户检测到压力较大时，沙发会自动切换到“放松模式”，调整为更柔软的状态，可能启动按摩功能。

# 系统架构和数据流

- **智能手环**：监测心率数据，并通过蓝牙或WiFi将数据上传至树莓派5。
- **树莓派5**：作为系统的主控中心，负责情绪分析和决策。处理摄像头和麦克风输入的数据，结合手环上传的心率数据进行情绪评估。
- **Intel Movidius算力棒**：用于加强树莓派5的计算能力。
- **ESP32模块**：连接到各个家具的控制组件（如电动推杆、按摩器、LED灯带等），负责接收树莓派的控制信号，并执行相应的控制操作。

# 项目用料

- **树莓派5**：运行情绪分析模型，作为系统的主控和数据处理核心。
- **智能手环**：用于采集用户的心率数据，可选择支持蓝牙的智能手环，确保能与树莓派建立数据传输连接。
- **ESP32模块**：作为家具的控制器，负责与树莓派通信并执行指令。每个家具控制端配置一个ESP32模块。
- **传感器和控制设备**：
    - **HikVision摄像头**：用于表情检测。
    - **麦克风**：用于收录语音，进行语音情绪分析。
    - **LED灯带和电动推杆（？）**：用于家具功能调整，如灯光控制和柔软度调节。
    - **电动按摩器**：用于放松功能。

# 主要功能模块实现

## 1. 心率数据获取和上传

- **智能手环到树莓派的通信**：确保手环支持蓝牙BLE通信。树莓派5可以使用Python的`bleak`库与手环连接，从手环的心率特征UUID获取数据。
- **数据处理**：树莓派将心率数据与其他情绪检测数据（表情、声音）整合，提供更精准的情绪评估。

## 2. 树莓派的情绪分析和决策

- **视觉分析**：使用树莓派摄像头模块和OpenCV/Dlib库进行表情识别，将面部关键点作为输入特征，判断情绪状态。
- **声音分析**：~~通过麦克风采集音频，使用librosa进行情绪特征提取，将声音特征输入情绪模型中。使用~~基于Pytorch实现的语音情感识别
- **情绪决策逻辑**：根据表情、声音和心率数据，判断用户是否处于“放松”、“焦虑”、“愉悦”等状态，触发相应的家具控制命令。

## 3. 家具控制和ESP32通信

- **ESP32与树莓派通信**：建议通过MQTT协议在局域网中建立稳定的通信。树莓派5作为MQTT Broker，ESP32订阅相应的主题（如“sofa/control”、“bed/control”）。
- **控制指令执行**：ESP32接收到命令后，通过PWM和GPIO控制具体的硬件，如控制电动推杆调节家具柔软度、控制LED灯光颜色和亮度等。

# 具体实现步骤

## 1. 树莓派5的情绪检测系统配置

- **摄像头和麦克风**：安装摄像头和麦克风，确保设备可以通过OpenCV和librosa库访问。
- **BLE心率数据采集**：用Python的`bleak`库扫描手环，找到心率特征UUID，实时获取心率数据。

## 2. 情绪数据的整合与分析

- **表情识别代码**：使用Python编写OpenCV代码，检测用户面部表情，生成情绪特征。
- **声音情绪分析**：~~用librosa处理音频数据，提取MFCC、能量等特征，输入情绪模型。使用~~基于Pytorch实现的语音情感识别
- **决策逻辑**：根据三种数据的组合（表情、声音、心率）编写决策逻辑。例如，心率升高、语气急促、面部紧张可以判断为“焦虑”，触发“放松模式”，等。

## 3. 树莓派5和ESP32的控制指令通信

- **配置MQTT**：在树莓派上安装Mosquitto作为MQTT Broker。ESP32通过Arduino IDE配置PubSubClient库，订阅各个家具的控制主题。
- **控制命令发布**：树莓派5根据情绪状态发布相应主题的消息，ESP32接收后执行命令。

## 4. ESP32控制家具硬件

- **电动推杆控制**：用ESP32的PWM信号控制电动推杆或按摩装置，逐步调节家具的柔软度或按摩力度。
- **LED灯带控制**：通过WS2812B或RGB灯带模块，调节灯光的亮度和颜色，匹配不同的情绪模式。

# 使用方法

1. **佩戴手环**：用户需佩戴支持BLE的智能手环，实时监测心率。
2. **进入房间**：摄像头和麦克风开始监测情绪，树莓派结合心率数据分析用户的情绪状态。
3. **情绪触发家具响应**：树莓派将分析结果发送到ESP32，ESP32根据指令调整灯光、按摩模式、家具角度等。
4. **手动控制和配置**：用户可通过手机或电脑端的控制界面，手动切换模式或设置个性化情绪触发规则。

# 项目分工（3人）

**Plan A (Decrete)**

- **硬件工程师（Zang）**：负责ESP32模块的配置和编程，以及与家具控制组件的集成。
- **软件工程师（Wen）**：负责树莓派5上的情绪分析算法开发，包括视觉、语音处理和决策逻辑的实现。
- **系统集成工程师（Zeng）**：负责整体系统的架构设计、通信协议的实现，以及用户界面的开发。

## **硬件工程师职责：**

• 配置和编程ESP32模块，确保其能接收树莓派的控制信号并执行相应操作。

• 集成家具控制组件（如电动推杆、按摩器、LED灯带等），确保硬件正确响应控制信号。

• 测试硬件组件功能，保证稳定性和响应速度。

• 负责智能手环与树莓派之间的蓝牙通信设置。

## **软件工程师职责：**

• 在树莓派5上开发情绪分析算法，包括面部表情识别和语音情绪分析。

• 使用OpenCV/Dlib库实现视觉分析，进行表情识别，将面部关键点作为输入特征。

• 使用librosa或Pytorch实现语音情感识别，提取音频特征。

• 编写情绪决策逻辑，根据表情、声音和心率数据判断用户情绪状态，触发相应的家具控制命令。

## **系统集成工程师职责：**

• 设计整体系统架构，确保各模块高效协同工作。

• 实现通信协议，特别是树莓派与ESP32之间的MQTT协议，确保通信稳定性和实时性。

• 开发用户界面，包括手机或电脑端的控制界面，以及实体椅子的手动控制界面，确保用户交互便利。

• 负责系统集成测试，确保硬件、软件和用户界面无缝对接。

**Plan B (Comprehensiveness)**

## Member A（Zang）

**硬件/系统集成和测试**

### 主要任务

**• 硬件设计与制作：**设计并制作实体椅子，集成和测试电动推杆、按摩器等硬件。

**• 系统集成与测试：**整合所有模块，进行全面系统测试，确保系统稳定性和可靠性。

### 次要任务

**• 传感器与数据采集：**协助配置智能手环与树莓派的蓝牙通信，设置摄像头和麦克风。

## Member B（Wen）

**项目协调、软件开发与情绪分析**

### 主要任务

**• 项目协调：**制定项目计划和时间表，协调团队成员工作。

**• 情绪识别与分析：**开发并训练情绪识别算法，包括面部表情识别和语音情绪分析。

**• 控制系统开发：**开发树莓派控制系统，包括情绪分析、决策逻辑，以及与ESP32的通信。

### 次要任务

**• 用户界面与交互设计：**设计并实现用户界面前端代码，确保易用性和美观性。

## Member C（Zeng）

**通信与网络/模型与演示制作**

### 主要任务

**• 通信与网络：**负责树莓派与ESP32间的通信，实现MQTT协议。

**• 模型与演示制作：**创建其他家具模型，实现动态演示，展示整个系统工作原理。

### 次要任务

**• 用户界面与交互设计：**协助设计用户界面，提供UI/UX设计建议。